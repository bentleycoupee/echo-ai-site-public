"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[568],{5568:(e,t,s)=>{let r;s.d(t,{sd:()=>et,Tb:()=>en});var i=s(4483),n=s(4752),o=s(5801);function a(e){let t,s;let r=e.split(":");return 1===r.length?(t=r[0],s="default"):(t=r.slice(0,r.length-1).join(":"),s=r[r.length-1]),t.endsWith(".js")&&(t=t.slice(0,-3)),`${t}:${s}`}function u(e,t){return JSON.stringify({udfPath:a(e),args:(0,n.rz)(t)})}var h=Object.defineProperty,l=(e,t,s)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,c=(e,t,s)=>l(e,"symbol"!=typeof t?t+"":t,s);class d{constructor(){c(this,"nextQueryId"),c(this,"querySetVersion"),c(this,"querySet"),c(this,"queryIdToToken"),c(this,"identityVersion"),c(this,"auth"),c(this,"outstandingQueriesOlderThanRestart"),c(this,"outstandingAuthOlderThanRestart"),c(this,"paused"),c(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return 0===this.outstandingQueriesOlderThanRestart.size&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(e,t,s,r){let i=a(e),o=u(i,t),h=this.querySet.get(o);if(void 0!==h)return h.numSubscribers+=1,{queryToken:o,modification:null,unsubscribe:()=>this.removeSubscriber(o)};{let e=this.nextQueryId++;this.querySet.set(o,{id:e,canonicalizedUdfPath:i,args:t,numSubscribers:1,journal:s,componentPath:r}),this.queryIdToToken.set(e,o);let a=this.querySetVersion,u=this.querySetVersion+1,h={type:"Add",queryId:e,udfPath:i,args:[(0,n.rz)(t)],journal:s,componentPath:r};return this.paused?this.pendingQuerySetModifications.set(e,h):this.querySetVersion=u,{queryToken:o,modification:{type:"ModifyQuerySet",baseVersion:a,newVersion:u,modifications:[h]},unsubscribe:()=>this.removeSubscriber(o)}}}transition(e){for(let t of e.modifications)switch(t.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(t.queryId);let e=t.journal;if(void 0!==e){let s=this.queryIdToToken.get(t.queryId);void 0!==s&&(this.querySet.get(s).journal=e)}break}case"QueryRemoved":this.outstandingQueriesOlderThanRestart.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}}queryId(e,t){let s=u(a(e),t),r=this.querySet.get(s);return void 0!==r?r.id:null}isCurrentOrNewerAuthVersion(e){return e>=this.identityVersion}setAuth(e){this.auth={tokenType:"User",value:e};let t=this.identityVersion;return this.paused||(this.identityVersion=t+1),{type:"Authenticate",baseVersion:t,...this.auth}}setAdminAuth(e,t){let s={tokenType:"Admin",value:e,impersonating:t};this.auth=s;let r=this.identityVersion;return this.paused||(this.identityVersion=r+1),{type:"Authenticate",baseVersion:r,...s}}clearAuth(){this.auth=void 0,this.markAuthCompletion();let e=this.identityVersion;return this.paused||(this.identityVersion=e+1),{type:"Authenticate",tokenType:"None",baseVersion:e}}hasAuth(){return!!this.auth}isNewAuth(e){return this.auth?.value!==e}queryPath(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).canonicalizedUdfPath:null}queryArgs(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).args:null}queryToken(e){return this.queryIdToToken.get(e)??null}queryJournal(e){return this.querySet.get(e)?.journal}restart(e){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();let t=[];for(let s of this.querySet.values()){let r={type:"Add",queryId:s.id,udfPath:s.canonicalizedUdfPath,args:[(0,n.rz)(s.args)],journal:s.journal,componentPath:s.componentPath};t.push(r),e.has(s.id)||this.outstandingQueriesOlderThanRestart.add(s.id)}this.querySetVersion=1;let s={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:t};if(!this.auth)return this.identityVersion=0,[s,void 0];this.outstandingAuthOlderThanRestart=!0;let r={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[s,r]}pause(){this.paused=!0}resume(){let e=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,t=void 0!==this.auth?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[e,t]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(e){let t=this.querySet.get(e);if(t.numSubscribers>1)return t.numSubscribers-=1,null;{this.querySet.delete(e),this.queryIdToToken.delete(t.id),this.outstandingQueriesOlderThanRestart.delete(t.id);let s=this.querySetVersion,r=this.querySetVersion+1,i={type:"Remove",queryId:t.id};return this.paused?this.pendingQuerySetModifications.has(t.id)?this.pendingQuerySetModifications.delete(t.id):this.pendingQuerySetModifications.set(t.id,i):this.querySetVersion=r,{type:"ModifyQuerySet",baseVersion:s,newVersion:r,modifications:[i]}}}}var f=Object.defineProperty,g=(e,t,s)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,p=(e,t,s)=>g(e,"symbol"!=typeof t?t+"":t,s);class y{constructor(e){this.logger=e,p(this,"inflightRequests"),p(this,"requestsOlderThanRestart"),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(e,t){return new Promise(s=>{this.inflightRequests.set(e.requestId,{message:e,status:{status:t?"Requested":"NotSent",requestedAt:new Date,onResult:s}})})}onResponse(e){let t,s;let r=this.inflightRequests.get(e.requestId);if(void 0===r||"Completed"===r.status.status)return null;let i="Mutation"===r.message.type?"mutation":"action",a=r.message.udfPath;for(let t of e.logLines)(0,o.Y7)(this.logger,"info",i,a,t);let u=r.status;if(e.success)t={success:!0,logLines:e.logLines,value:(0,n.du)(e.result)},s=()=>u.onResult(t);else{let r=e.result,{errorData:h}=e;(0,o.Y7)(this.logger,"error",i,a,r),t={success:!1,errorMessage:r,errorData:void 0!==h?(0,n.du)(h):void 0,logLines:e.logLines},s=()=>u.onResult(t)}return"ActionResponse"!==e.type&&e.success?(r.status={status:"Completed",result:t,ts:e.ts,onResolve:s},null):(s(),this.inflightRequests.delete(e.requestId),this.requestsOlderThanRestart.delete(e.requestId),{requestId:e.requestId,result:t})}removeCompleted(e){let t=new Map;for(let[s,r]of this.inflightRequests.entries()){let i=r.status;"Completed"===i.status&&i.ts.lessThanOrEqual(e)&&(i.onResolve(),t.set(s,i.result),this.inflightRequests.delete(s),this.requestsOlderThanRestart.delete(s))}return t}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());let e=[];for(let[t,s]of this.inflightRequests){if("NotSent"===s.status.status){s.status.status="Requested",e.push(s.message);continue}if("Mutation"===s.message.type)e.push(s.message);else{if(this.inflightRequests.delete(t),this.requestsOlderThanRestart.delete(t),"Completed"===s.status.status)throw Error("Action should never be in 'Completed' state");s.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}return e}resume(){let e=[];for(let[,t]of this.inflightRequests)if("NotSent"===t.status.status){t.status.status="Requested",e.push(t.message);continue}return e}hasIncompleteRequests(){for(let e of this.inflightRequests.values())if("Requested"===e.status.status)return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return 0===this.requestsOlderThanRestart.size}timeOfOldestInflightRequest(){if(0===this.inflightRequests.size)return null;let e=Date.now();for(let t of this.inflightRequests.values())"Completed"!==t.status.status&&t.status.requestedAt.getTime()<e&&(e=t.status.requestedAt.getTime());return new Date(e)}}var m=s(5757),w=s(9839),v=s(87),b=Object.defineProperty,k=(e,t,s)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,S=(e,t,s)=>k(e,"symbol"!=typeof t?t+"":t,s);class A{constructor(e){S(this,"queryResults"),S(this,"modifiedQueries"),this.queryResults=e,this.modifiedQueries=[]}getQuery(e,...t){let s=(0,w.Zy)(t[0]),r=(0,m.qQ)(e),i=this.queryResults.get(u(r,s));if(void 0!==i)return A.queryValue(i.result)}getAllQueries(e){let t=[],s=(0,m.qQ)(e);for(let e of this.queryResults.values())e.udfPath===a(s)&&t.push({args:e.args,value:A.queryValue(e.result)});return t}setQuery(e,t,s){let r=(0,w.Zy)(t),i=(0,m.qQ)(e),n=u(i,r);this.queryResults.set(n,{udfPath:i,args:r,result:void 0===s?void 0:{success:!0,value:s,logLines:[]}}),this.modifiedQueries.push(n)}static queryValue(e){return void 0===e?void 0:e.success?e.value:void 0}}class q{constructor(){S(this,"queryResults"),S(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(e,t){this.optimisticUpdates=this.optimisticUpdates.filter(e=>!t.has(e.mutationId));let s=this.queryResults;this.queryResults=new Map(e);let r=new A(this.queryResults);for(let e of this.optimisticUpdates)e.update(r);let i=[];for(let[e,t]of this.queryResults){let r=s.get(e);(void 0===r||r.result!==t.result)&&i.push(e)}return i}applyOptimisticUpdate(e,t){this.optimisticUpdates.push({update:e,mutationId:t});let s=new A(this.queryResults);return e(s),s.modifiedQueries}queryResult(e){let t=this.queryResults.get(e);if(void 0===t)return;let s=t.result;if(void 0!==s){if(s.success)return s.value;if(void 0!==s.errorData)throw(0,o.sA)(s,new v.i((0,o.i7)("query",t.udfPath,s)));throw Error((0,o.i7)("query",t.udfPath,s))}}hasQueryResult(e){return void 0!==this.queryResults.get(e)}queryLogs(e){let t=this.queryResults.get(e);return t?.result?.logLines}}var R=Object.defineProperty,O=(e,t,s)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,T=(e,t,s)=>O(e,"symbol"!=typeof t?t+"":t,s);class C{constructor(e,t){T(this,"low"),T(this,"high"),T(this,"__isUnsignedLong__"),this.low=0|e,this.high=0|t,this.__isUnsignedLong__=!0}static isLong(e){return!0===(e&&e.__isUnsignedLong__)}static fromBytesLE(e){return new C(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24)}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}static fromNumber(e){return isNaN(e)||e<0?x:e>=$?I:new C(e%M|0,e/M|0)}toString(){return(BigInt(this.high)*BigInt(M)+BigInt(this.low)).toString()}equals(e){return C.isLong(e)||(e=C.fromValue(e)),(this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}notEquals(e){return!this.equals(e)}comp(e){return(C.isLong(e)||(e=C.fromValue(e)),this.equals(e))?0:e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(e){return 0>=this.comp(e)}static fromValue(e){return"number"==typeof e?C.fromNumber(e):new C(e.low,e.high)}}let x=new C(0,0),M=0x100000000,$=0xffffffffffffffff,I=new C(-1,-1);var E=Object.defineProperty,L=(e,t,s)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,V=(e,t,s)=>L(e,"symbol"!=typeof t?t+"":t,s);class Q{constructor(e,t){V(this,"version"),V(this,"remoteQuerySet"),V(this,"queryPath"),V(this,"logger"),this.version={querySet:0,ts:C.fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=e,this.logger=t}transition(e){let t=e.startVersion;if(this.version.querySet!==t.querySet||this.version.ts.notEquals(t.ts)||this.version.identity!==t.identity)throw Error(`Invalid start version: ${t.ts.toString()}:${t.querySet}`);for(let t of e.modifications)switch(t.type){case"QueryUpdated":{let e=this.queryPath(t.queryId);if(e)for(let s of t.logLines)(0,o.Y7)(this.logger,"info","query",e,s);let s=(0,n.du)(t.value??null);this.remoteQuerySet.set(t.queryId,{success:!0,value:s,logLines:t.logLines});break}case"QueryFailed":{let e=this.queryPath(t.queryId);if(e)for(let s of t.logLines)(0,o.Y7)(this.logger,"info","query",e,s);let{errorData:s}=t;this.remoteQuerySet.set(t.queryId,{success:!1,errorMessage:t.errorMessage,errorData:void 0!==s?(0,n.du)(s):void 0,logLines:t.logLines});break}case"QueryRemoved":this.remoteQuerySet.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}this.version=e.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}}function j(e){let t=n.o4.toByteArray(e);return C.fromBytesLE(Array.from(t))}var _=Object.defineProperty,P=(e,t,s)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,F=(e,t,s)=>P(e,"symbol"!=typeof t?t+"":t,s);class N{constructor(e,t,s,r){F(this,"socket"),F(this,"connectionCount"),F(this,"lastCloseReason"),F(this,"initialBackoff"),F(this,"maxBackoff"),F(this,"retries"),F(this,"serverInactivityThreshold"),F(this,"reconnectDueToServerInactivityTimeout"),F(this,"uri"),F(this,"onOpen"),F(this,"onResume"),F(this,"onMessage"),F(this,"webSocketConstructor"),F(this,"logger"),this.webSocketConstructor=s,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.initialBackoff=100,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=3e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=e,this.onOpen=t.onOpen,this.onResume=t.onResume,this.onMessage=t.onMessage,this.logger=r,this.connect()}connect(){if("terminated"===this.socket.state)return;if("disconnected"!==this.socket.state&&"stopped"!==this.socket.state)throw Error("Didn't start connection from disconnected state: "+this.socket.state);let e=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.socket={state:"connecting",ws:e,paused:"no"},this.resetServerInactivityTimeout(),e.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),"connecting"!==this.socket.state)throw Error("onopen called with socket not in connecting state");this.socket={state:"ready",ws:e,paused:"yes"===this.socket.paused?"uninitialized":"no"},this.resetServerInactivityTimeout(),"no"===this.socket.paused&&this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason}),"InitialConnect"!==this.lastCloseReason&&this.logger.log("WebSocket reconnected"),this.connectionCount+=1,this.lastCloseReason=null},e.onerror=e=>{let t=e.message;this.logger.log(`WebSocket error: ${t}`)},e.onmessage=e=>{this.resetServerInactivityTimeout();let t=function(e){switch(e.type){case"FatalError":case"AuthError":case"ActionResponse":case"Ping":return{...e};case"MutationResponse":if(e.success)return{...e,ts:j(e.ts)};return{...e};case"Transition":return{...e,startVersion:{...e.startVersion,ts:j(e.startVersion.ts)},endVersion:{...e.endVersion,ts:j(e.endVersion.ts)}}}}(JSON.parse(e.data));this._logVerbose(`received ws message with type ${t.type}`),this.onMessage(t).hasSyncedPastLastReconnect&&(this.retries=0)},e.onclose=e=>{if(this._logVerbose("begin ws.onclose"),null===this.lastCloseReason&&(this.lastCloseReason=e.reason??"OnCloseInvoked"),1e3!==e.code&&1001!==e.code&&1005!==e.code&&4040!==e.code){let t=`WebSocket closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.logger.log(t)}this.scheduleReconnect()}}socketState(){return this.socket.state}sendMessage(e){if(this._logVerbose(`sending message with type ${e.type}`),"ready"===this.socket.state&&"no"===this.socket.paused){let t=JSON.stringify(function(e){switch(e.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...e};case"Connect":if(void 0!==e.maxObservedTimestamp)return{...e,maxObservedTimestamp:function(e){let t=new Uint8Array(e.toBytesLE());return n.o4.fromByteArray(t)}(e.maxObservedTimestamp)};return{...e,maxObservedTimestamp:void 0}}}(e));try{this.socket.ws.send(t)}catch(e){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${e}`),this.closeAndReconnect("FailedToSendMessage")}return!0}return!1}resetServerInactivityTimeout(){"terminated"!==this.socket.state&&(null!==this.reconnectDueToServerInactivityTimeout&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(){this.socket={state:"disconnected"};let e=this.nextBackoff();this.logger.log(`Attempting reconnect in ${e}ms`),setTimeout(()=>this.connect(),e)}closeAndReconnect(e){switch(this._logVerbose(`begin closeAndReconnect with reason ${e}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":this.lastCloseReason=e,this.close(),this.scheduleReconnect();return;default:this.socket}}close(){switch(this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{let e=this.socket.ws;return new Promise(t=>{e.onclose=()=>{this._logVerbose("Closed after connecting"),t()},e.onopen=()=>{this._logVerbose("Opened after connecting"),e.close()}})}case"ready":{this._logVerbose("ws.close called");let e=this.socket.ws,t=new Promise(t=>{e.onclose=()=>{t()}});return e.close(),t}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{let e=this.close();return this.socket={state:"terminated"},e}default:throw this.socket,Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{let e=this.close();return this.socket={state:"stopped"},e}default:return this.socket,Promise.resolve()}}restart(){switch(this.socket.state){case"stopped":break;case"terminated":return;case"connecting":case"ready":case"disconnected":throw Error("`restart()` is only valid after `stop()`");default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":this.socket={...this.socket,paused:"yes"};return;default:this.socket;return}}resume(){switch(this.socket.state){case"connecting":this.socket={...this.socket,paused:"no"};return;case"ready":"uninitialized"===this.socket.paused?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason})):"yes"===this.socket.paused&&(this.socket={...this.socket,paused:"no"},this.onResume());return;case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}_logVerbose(e){this.logger.logVerbose(e)}nextBackoff(){let e=this.initialBackoff*Math.pow(2,this.retries);this.retries+=1;let t=Math.min(e,this.maxBackoff),s=t*(Math.random()-.5);return t+s}}function B(e){this.message=e}B.prototype=Error(),B.prototype.name="InvalidCharacterError";var D="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new B("'atob' failed: The string to be decoded is not correctly encoded.");for(var s,r,i=0,n=0,o="";r=t.charAt(n++);~r&&(s=i%4?64*s+r:r,i++%4)&&(o+=String.fromCharCode(255&s>>(-2*i&6))))r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return o};function U(e){this.message=e}U.prototype=Error(),U.prototype.name="InvalidTokenError";let z=function(e,t){if("string"!=typeof e)throw new U("Invalid token specified");var s=!0===(t=t||{}).header?0:1;try{return JSON.parse(function(e){var t,s=e.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw"Illegal base64url string!"}try{return t=s,decodeURIComponent(D(t).replace(/(.)/g,function(e,t){var s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch(e){return D(s)}}(e.split(".")[s]))}catch(e){throw new U("Invalid token specified: "+e.message)}};var W=Object.defineProperty,J=(e,t,s)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Z=(e,t,s)=>J(e,"symbol"!=typeof t?t+"":t,s);class Y{constructor(e,t,s){Z(this,"authState",{state:"noAuth"}),Z(this,"configVersion",0),Z(this,"syncState"),Z(this,"authenticate"),Z(this,"stopSocket"),Z(this,"restartSocket"),Z(this,"pauseSocket"),Z(this,"resumeSocket"),Z(this,"clearAuth"),Z(this,"logger"),Z(this,"refreshTokenLeewaySeconds"),this.syncState=e,this.authenticate=t.authenticate,this.stopSocket=t.stopSocket,this.restartSocket=t.restartSocket,this.pauseSocket=t.pauseSocket,this.resumeSocket=t.resumeSocket,this.clearAuth=t.clearAuth,this.logger=s.logger,this.refreshTokenLeewaySeconds=s.refreshTokenLeewaySeconds}async setConfig(e,t){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();let s=await this.fetchTokenAndGuardAgainstRace(e,{forceRefreshToken:!1});s.isFromOutdatedConfig||(s.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:e,onAuthChange:t},hasRetried:!1}),this.authenticate(s.value),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket()):(this.setAuthState({state:"initialRefetch",config:{fetchToken:e,onAuthChange:t}}),await this.refetchToken()))}onTransition(e){if(this.syncState.isCurrentOrNewerAuthVersion(e.endVersion.identity)&&!(e.endVersion.identity<=e.startVersion.identity)){if("waitingForServerConfirmationOfCachedToken"===this.authState.state){this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),this.authState.config.onAuthChange(!0);return}"waitingForServerConfirmationOfFreshToken"!==this.authState.state||(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.authState.hadAuth||this.authState.config.onAuthChange(!0))}}onAuthError(e){let{baseVersion:t}=e;if(null!=t){if(!this.syncState.isCurrentOrNewerAuthVersion(t+1)){this._logVerbose("ignoring auth error for previous auth attempt");return}this.tryToReauthenticate(e);return}this.tryToReauthenticate(e)}async tryToReauthenticate(e){if("noAuth"===this.authState.state||"waitingForServerConfirmationOfFreshToken"===this.authState.state){this.logger.error(`Failed to authenticate: "${e.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),"noAuth"!==this.authState.state&&this.setAndReportAuthFailed(this.authState.config.onAuthChange);return}this._logVerbose("attempting to reauthenticate"),await this.stopSocket();let t=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});t.isFromOutdatedConfig||(t.value&&this.syncState.isNewAuth(t.value)?(this.authenticate(t.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:t.value,hadAuth:"notRefetching"===this.authState.state||"waitingForScheduledRefetch"===this.authState.state})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.restartSocket())}async refetchToken(){if("noAuth"===this.authState.state)return;this._logVerbose("refetching auth token");let e=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});e.isFromOutdatedConfig||(e.value?this.syncState.isNewAuth(e.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:e.value,config:this.authState.config}),this.authenticate(e.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("resuming WS after auth token fetch (if currently paused)"),this.resumeSocket())}scheduleTokenRefetch(e){if("noAuth"===this.authState.state)return;let t=this.decodeToken(e);if(!t){this.logger.error("Auth token is not a valid JWT, cannot refetch the token");return}let{iat:s,exp:r}=t;if(!s||!r){this.logger.error("Auth token does not have required fields, cannot refetch the token");return}let i=r-s;if(i<=2){this.logger.error("Auth token does not live long enough, cannot refetch the token");return}let n=Math.min(1728e6,(i-this.refreshTokenLeewaySeconds)*1e3);n<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${i}s`),n=0);let o=setTimeout(()=>{this.refetchToken()},n);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:o,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${n}ms`)}async fetchTokenAndGuardAgainstRace(e,t){let s=++this.configVersion,r=await e(t);return this.configVersion!==s?{isFromOutdatedConfig:!0}:{isFromOutdatedConfig:!1,value:r}}stop(){this.resetAuthState(),this.configVersion++}setAndReportAuthFailed(e){e(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(e){"waitingForScheduledRefetch"===this.authState.state&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=e}decodeToken(e){try{return z(e)}catch(e){return this._logVerbose(`Error decoding token: ${e instanceof Error?e.message:"Unknown error"}`),null}}_logVerbose(e){this.logger.logVerbose(`${e} [v${this.configVersion}]`)}}let H=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function G(e){let t=e.name.slice(6);return{name:t=t.charAt(0).toLowerCase()+t.slice(1),startTime:e.startTime}}var X=Object.defineProperty,K=(e,t,s)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ee=(e,t,s)=>K(e,"symbol"!=typeof t?t+"":t,s);class et{constructor(e,t,s){let r;if(ee(this,"address"),ee(this,"state"),ee(this,"requestManager"),ee(this,"webSocketManager"),ee(this,"authenticationManager"),ee(this,"remoteQuerySet"),ee(this,"optimisticQueryResults"),ee(this,"_transitionHandlerCounter",0),ee(this,"_nextRequestId"),ee(this,"_onTransitionFns",new Map),ee(this,"_sessionId"),ee(this,"firstMessageReceived",!1),ee(this,"debug"),ee(this,"logger"),ee(this,"maxObservedTimestamp"),ee(this,"mark",e=>{if(this.debug){var t;t=this.sessionId,"undefined"!=typeof performance&&performance.mark&&performance.mark(e,{detail:{sessionId:t}})}}),"object"==typeof e)throw Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");s?.skipConvexDeploymentUrlCheck!==!0&&(0,w.R6)(e);let n=(s={...s}).authRefreshTokenLeewaySeconds??2,a=s.webSocketConstructor;if(!a&&"undefined"==typeof WebSocket)throw Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");a=a||WebSocket,this.debug=s.reportDebugInfoToConvex??!1,this.address=e,this.logger=s.logger??(0,o.y4)({verbose:s.verbose??!1});let u=e.search("://");if(-1===u)throw Error("Provided address was not an absolute URL.");let h=e.substring(u+3),l=e.substring(0,u);if("http"===l)r="ws";else if("https"===l)r="wss";else throw Error(`Unknown parent protocol ${l}`);let c=`${r}://${h}/api/${i.r}/sync`;this.state=new d,this.remoteQuerySet=new Q(e=>this.state.queryPath(e),this.logger),this.requestManager=new y(this.logger),this.authenticationManager=new Y(this.state,{authenticate:e=>{let t=this.state.setAuth(e);this.webSocketManager.sendMessage(t)},stopSocket:()=>this.webSocketManager.stop(),restartSocket:()=>this.webSocketManager.restart(),pauseSocket:()=>{this.webSocketManager.pause(),this.state.pause()},resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:n}),this.optimisticQueryResults=new q,this.addOnTransitionHandler(e=>{t(e.queries.map(e=>e.token))}),this._nextRequestId=0,this._sessionId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});let{unsavedChangesWarning:f}=s;if("undefined"==typeof window||void 0===window.addEventListener){if(!0===f)throw Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.")}else!1!==f&&window.addEventListener("beforeunload",e=>{if(this.requestManager.hasIncompleteRequests()){e.preventDefault();let t="Are you sure you want to leave? Your changes may not be saved.";return(e||window.event).returnValue=t,t}});this.webSocketManager=new N(c,{onOpen:e=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...e,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});let t=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new Q(e=>this.state.queryPath(e),this.logger);let[s,r]=this.state.restart(t);for(let e of(r&&this.webSocketManager.sendMessage(r),this.webSocketManager.sendMessage(s),this.requestManager.restart()))this.webSocketManager.sendMessage(e)},onResume:()=>{let[e,t]=this.state.resume();for(let s of(t&&this.webSocketManager.sendMessage(t),e&&this.webSocketManager.sendMessage(e),this.requestManager.resume()))this.webSocketManager.sendMessage(s)},onMessage:e=>{switch(this.firstMessageReceived||(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),e.type){case"Transition":{this.observedTimestamp(e.endVersion.ts),this.authenticationManager.onTransition(e),this.remoteQuerySet.transition(e),this.state.transition(e);let t=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(t);break}case"MutationResponse":{e.success&&this.observedTimestamp(e.ts);let t=this.requestManager.onResponse(e);null!==t&&this.notifyOnQueryResultChanges(new Map([[t.requestId,t.result]]));break}case"ActionResponse":this.requestManager.onResponse(e);break;case"AuthError":this.authenticationManager.onAuthError(e);break;case"FatalError":{let t=(0,o.Z4)(this.logger,e.error);throw this.webSocketManager.terminate(),t}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}}},a,this.logger),this.mark("convexClientConstructed")}hasSyncedPastLastReconnect(){return this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect()}observedTimestamp(e){(void 0===this.maxObservedTimestamp||this.maxObservedTimestamp.lessThanOrEqual(e))&&(this.maxObservedTimestamp=e)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(e){let t=this.remoteQuerySet.remoteQueryResults(),s=new Map;for(let[e,r]of t){let t=this.state.queryToken(e);if(null!==t){let i={result:r,udfPath:this.state.queryPath(e),args:this.state.queryArgs(e)};s.set(t,i)}}let r=this.optimisticQueryResults.ingestQueryResultsFromServer(s,new Set(e.keys()));this.handleTransition({queries:r.map(e=>({token:e,modification:{kind:"Updated",result:s.get(e).result}})),reflectedMutations:Array.from(e).map(([e,t])=>({requestId:e,result:t})),timestamp:this.remoteQuerySet.timestamp()})}handleTransition(e){for(let t of this._onTransitionFns.values())t(e)}addOnTransitionHandler(e){let t=this._transitionHandlerCounter++;return this._onTransitionFns.set(t,e),()=>this._onTransitionFns.delete(t)}setAuth(e,t){this.authenticationManager.setConfig(e,t)}hasAuth(){return this.state.hasAuth()}setAdminAuth(e,t){let s=this.state.setAdminAuth(e,t);this.webSocketManager.sendMessage(s)}clearAuth(){let e=this.state.clearAuth();this.webSocketManager.sendMessage(e)}subscribe(e,t,s){let r=(0,w.Zy)(t),{modification:i,queryToken:n,unsubscribe:o}=this.state.subscribe(e,r,s?.journal,s?.componentPath);return null!==i&&this.webSocketManager.sendMessage(i),{queryToken:n,unsubscribe:()=>{let e=o();e&&this.webSocketManager.sendMessage(e)}}}localQueryResult(e,t){let s=u(e,(0,w.Zy)(t));return this.optimisticQueryResults.queryResult(s)}localQueryResultByToken(e){return this.optimisticQueryResults.queryResult(e)}hasLocalQueryResultByToken(e){return this.optimisticQueryResults.hasQueryResult(e)}localQueryLogs(e,t){let s=u(e,(0,w.Zy)(t));return this.optimisticQueryResults.queryLogs(s)}queryJournal(e,t){let s=u(e,(0,w.Zy)(t));return this.state.queryJournal(s)}connectionState(){return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:"ready"===this.webSocketManager.socketState(),timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest()}}async mutation(e,t,s){let r=await this.mutationInternal(e,t,s);if(!r.success){if(void 0!==r.errorData)throw(0,o.sA)(r,new v.i((0,o.i7)("mutation",e,r)));throw Error((0,o.i7)("mutation",e,r))}return r.value}async mutationInternal(e,t,s,r){let{mutationPromise:i}=this.enqueueMutation(e,t,s,r);return i}enqueueMutation(e,t,s,r){let i=(0,w.Zy)(t);this.tryReportLongDisconnect();let o=this.nextRequestId;if(this._nextRequestId++,void 0!==s){let e=s.optimisticUpdate;if(void 0!==e){let t=this.optimisticQueryResults.applyOptimisticUpdate(t=>{e(t,i)},o).map(e=>{let t=this.localQueryResultByToken(e);return{token:e,modification:{kind:"Updated",result:void 0===t?void 0:{success:!0,value:t,logLines:[]}}}});this.handleTransition({queries:t,reflectedMutations:[],timestamp:this.remoteQuerySet.timestamp()})}}let a={type:"Mutation",requestId:o,udfPath:e,componentPath:r,args:[(0,n.rz)(i)]},u=this.webSocketManager.sendMessage(a);return{requestId:o,mutationPromise:this.requestManager.request(a,u)}}async action(e,t){let s=await this.actionInternal(e,t);if(!s.success){if(void 0!==s.errorData)throw(0,o.sA)(s,new v.i((0,o.i7)("action",e,s)));throw Error((0,o.i7)("action",e,s))}return s.value}async actionInternal(e,t,s){let r=(0,w.Zy)(t),i=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();let o={type:"Action",requestId:i,udfPath:e,componentPath:s,args:[(0,n.rz)(r)]},a=this.webSocketManager.sendMessage(o);return this.requestManager.request(o,a)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){let e=function(e){if("undefined"==typeof performance||!performance.getEntriesByName)return[];let t=[];for(let s of H){let r=performance.getEntriesByName(s).filter(e=>"mark"===e.entryType).filter(t=>t.detail.sessionId===e);t.push(...r)}return t.map(G)}(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:e})}}tryReportLongDisconnect(){if(!this.debug)return;let e=this.connectionState().timeOfOldestInflightRequest;null===e||Date.now()-e.getTime()<=6e4||fetch(`${this.address}/api/debug_event`,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${i.r}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(e=>{e.ok||this.logger.warn("Analytics request failed with response:",e.body)}).catch(e=>{this.logger.warn("Analytics response failed with error:",e)})}}var es=Object.defineProperty,er=(e,t,s)=>t in e?es(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ei=(e,t,s)=>er(e,"symbol"!=typeof t?t+"":t,s);class en{constructor(e,t){if(ei(this,"address"),ei(this,"auth"),ei(this,"adminAuth"),ei(this,"encodedTsPromise"),ei(this,"debug"),ei(this,"fetchOptions"),ei(this,"logger"),"boolean"==typeof t)throw Error("skipConvexDeploymentUrlCheck as the second argument is no longer supported. Please pass an options object, `{ skipConvexDeploymentUrlCheck: true }`.");let s=t??{};!0!==s.skipConvexDeploymentUrlCheck&&(0,w.R6)(e),this.logger=s.logger??(0,o.y4)({verbose:!1}),this.address=e,this.debug=!0}backendUrl(){return`${this.address}/api`}get url(){return this.address}setAuth(e){this.clearAuth(),this.auth=e}setAdminAuth(e,t){if(this.clearAuth(),void 0!==t){let s=btoa(String.fromCodePoint(...new TextEncoder().encode(JSON.stringify(t))));this.adminAuth=`${e}:${s}`}else this.adminAuth=e}clearAuth(){this.auth=void 0,this.adminAuth=void 0}setDebug(e){this.debug=e}setFetchOptions(e){this.fetchOptions=e}async consistentQuery(e,...t){let s=(0,w.Zy)(t[0]),r=this.getTimestamp();return await this.queryInner(e,s,{timestampPromise:r})}async getTimestamp(){return this.encodedTsPromise?this.encodedTsPromise:this.encodedTsPromise=this.getTimestampInner()}async getTimestampInner(){let e=r||fetch,t={"Content-Type":"application/json","Convex-Client":`npm-${i.r}`},s=await e(`${this.address}/api/query_ts`,{...this.fetchOptions,method:"POST",headers:t});if(!s.ok)throw Error(await s.text());let{ts:n}=await s.json();return n}async query(e,...t){let s=(0,w.Zy)(t[0]);return await this.queryInner(e,s,{})}async queryInner(e,t,s){let a=(0,m.qQ)(e),u=[(0,n.rz)(t)],h={"Content-Type":"application/json","Convex-Client":`npm-${i.r}`};this.adminAuth?h.Authorization=`Convex ${this.adminAuth}`:this.auth&&(h.Authorization=`Bearer ${this.auth}`);let l=r||fetch,c=s.timestampPromise?await s.timestampPromise:void 0,d=JSON.stringify({path:a,format:"convex_encoded_json",args:u,...c?{ts:c}:{}}),f=c?`${this.address}/api/query_at_ts`:`${this.address}/api/query`,g=await l(f,{...this.fetchOptions,body:d,method:"POST",headers:h});if(!g.ok&&560!==g.status)throw Error(await g.text());let p=await g.json();if(this.debug)for(let e of p.logLines??[])(0,o.Y7)(this.logger,"info","query",a,e);switch(p.status){case"success":return(0,n.du)(p.value);case"error":if(void 0!==p.errorData)throw eo(p.errorData,new n.ik(p.errorMessage));throw Error(p.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(p)}`)}}async mutation(e,...t){let s=(0,w.Zy)(t[0]),a=(0,m.qQ)(e),u=JSON.stringify({path:a,format:"convex_encoded_json",args:[(0,n.rz)(s)]}),h={"Content-Type":"application/json","Convex-Client":`npm-${i.r}`};this.adminAuth?h.Authorization=`Convex ${this.adminAuth}`:this.auth&&(h.Authorization=`Bearer ${this.auth}`);let l=r||fetch,c=await l(`${this.address}/api/mutation`,{...this.fetchOptions,body:u,method:"POST",headers:h});if(!c.ok&&560!==c.status)throw Error(await c.text());let d=await c.json();if(this.debug)for(let e of d.logLines??[])(0,o.Y7)(this.logger,"info","mutation",a,e);switch(d.status){case"success":return(0,n.du)(d.value);case"error":if(void 0!==d.errorData)throw eo(d.errorData,new n.ik(d.errorMessage));throw Error(d.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(d)}`)}}async action(e,...t){let s=(0,w.Zy)(t[0]),a=(0,m.qQ)(e),u=JSON.stringify({path:a,format:"convex_encoded_json",args:[(0,n.rz)(s)]}),h={"Content-Type":"application/json","Convex-Client":`npm-${i.r}`};this.adminAuth?h.Authorization=`Convex ${this.adminAuth}`:this.auth&&(h.Authorization=`Bearer ${this.auth}`);let l=r||fetch,c=await l(`${this.address}/api/action`,{...this.fetchOptions,body:u,method:"POST",headers:h});if(!c.ok&&560!==c.status)throw Error(await c.text());let d=await c.json();if(this.debug)for(let e of d.logLines??[])(0,o.Y7)(this.logger,"info","action",a,e);switch(d.status){case"success":return(0,n.du)(d.value);case"error":if(void 0!==d.errorData)throw eo(d.errorData,new n.ik(d.errorMessage));throw Error(d.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(d)}`)}}async function(e,t,...s){let a=(0,w.Zy)(s[0]),u="string"==typeof e?e:(0,m.qQ)(e),h=JSON.stringify({componentPath:t,path:u,format:"convex_encoded_json",args:(0,n.rz)(a)}),l={"Content-Type":"application/json","Convex-Client":`npm-${i.r}`};this.adminAuth?l.Authorization=`Convex ${this.adminAuth}`:this.auth&&(l.Authorization=`Bearer ${this.auth}`);let c=r||fetch,d=await c(`${this.address}/api/function`,{...this.fetchOptions,body:h,method:"POST",headers:l});if(!d.ok&&560!==d.status)throw Error(await d.text());let f=await d.json();if(this.debug)for(let e of f.logLines??[])(0,o.Y7)(this.logger,"info","any",u,e);switch(f.status){case"success":return(0,n.du)(f.value);case"error":if(void 0!==f.errorData)throw eo(f.errorData,new n.ik(f.errorMessage));throw Error(f.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(f)}`)}}}function eo(e,t){return t.data=(0,n.du)(e),t}},5801:(e,t,s)=>{s.d(t,{Y7:()=>h,Z4:()=>l,i7:()=>c,sA:()=>d,y4:()=>u});var r=Object.defineProperty,i=(e,t,s)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,n=(e,t,s)=>i(e,"symbol"!=typeof t?t+"":t,s);function o(e){switch(e){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}class a{constructor(e){n(this,"_onLogLineFuncs"),n(this,"_verbose"),this._onLogLineFuncs={},this._verbose=e.verbose}addLogLineListener(e){let t=Math.random().toString(36).substring(2,15);for(let e=0;e<10&&void 0!==this._onLogLineFuncs[t];e++)t=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[t]=e,()=>{delete this._onLogLineFuncs[t]}}logVerbose(...e){if(this._verbose)for(let t of Object.values(this._onLogLineFuncs))t("debug",`${new Date().toISOString()}`,...e)}log(...e){for(let t of Object.values(this._onLogLineFuncs))t("info",...e)}warn(...e){for(let t of Object.values(this._onLogLineFuncs))t("warn",...e)}error(...e){for(let t of Object.values(this._onLogLineFuncs))t("error",...e)}}function u(e){let t=new a(e);return t.addLogLineListener((e,...t)=>{switch(e){case"debug":console.debug(...t);break;case"info":default:console.log(...t);break;case"warn":console.warn(...t);break;case"error":console.error(...t)}}),t}function h(e,t,s,r,i){let n=o(s);if("object"==typeof i&&(i=`ConvexError ${JSON.stringify(i.errorData,null,2)}`),"info"===t){let t=i.match(/^\[.*?\] /);if(null===t){e.error(`[CONVEX ${n}(${r})] Could not parse console.log`);return}let s=i.slice(1,t[0].length-2),o=i.slice(t[0].length);e.log(`%c[CONVEX ${n}(${r})] [${s}]`,"color:rgb(0, 145, 255)",o)}else e.error(`[CONVEX ${n}(${r})] ${i}`)}function l(e,t){let s=`[CONVEX FATAL ERROR] ${t}`;return e.error(s),Error(s)}function c(e,t,s){let r=o(e);return`[CONVEX ${r}(${t})] ${s.errorMessage}
  Called by client`}function d(e,t){return t.data=e.errorData,t}},9839:(e,t,s)=>{function r(e){if(void 0===e)return{};if(!n(e))throw Error(`The arguments to a Convex function must be an object. Received: ${e}`);return e}function i(e){if(void 0===e)throw Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if("string"!=typeof e)throw Error(`Invalid deployment address: found ${e}".`);if(!(e.startsWith("http:")||e.startsWith("https:")))throw Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${e}".`);try{new URL(e)}catch{throw Error(`Invalid deployment address: "${e}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(e.endsWith(".convex.site"))throw Error(`Invalid deployment address: "${e}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}function n(e){let t="object"==typeof e,s=Object.getPrototypeOf(e),r=null===s||s===Object.prototype||s?.constructor?.name==="Object";return t&&r}s.d(t,{R6:()=>i,Zy:()=>r,iY:()=>n})},4483:(e,t,s)=>{s.d(t,{r:()=>r});let r="1.18.2"},5757:(e,t,s)=>{s.d(t,{Gg:()=>o,dp:()=>a,qQ:()=>n});var r=s(6236),i=s(712);function n(e){let t=(0,i.Jc)(e);if(void 0===t.name){if(void 0!==t.functionHandle)throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${t.functionHandle}`);if(void 0!==t.reference)throw Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${t.reference}`);throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(t)}`)}if("string"==typeof e)return e;let s=e[r.A];if(!s)throw Error(`${e} is not a functionReference`);return s}function o(e){return{[r.A]:e}}let a=function e(t=[]){return new Proxy({},{get(s,i){if("string"==typeof i)return e([...t,i]);if(i===r.A){if(t.length<2){let e=["api",...t].join(".");throw Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${e}\``)}let e=t.slice(0,-1).join("/"),s=t[t.length-1];return"default"===s?e:e+":"+s}return i===Symbol.toStringTag?"FunctionReference":void 0}})}()},712:(e,t,s)=>{s.d(t,{Jc:()=>n});var r=s(6236);let i=Symbol.for("toReferencePath");function n(e){let t;if("string"==typeof e)t=e.startsWith("function://")?{functionHandle:e}:{name:e};else if(e[r.A])t={name:e[r.A]};else{let s=e[i]??null;if(!s)throw Error(`${e} is not a functionReference`);t={reference:s}}return t}},6236:(e,t,s)=>{s.d(t,{A:()=>r});let r=Symbol.for("functionName")},2271:(e,t,s)=>{s.r(t),s.d(t,{byteLength:()=>l,fromByteArray:()=>d,toByteArray:()=>c});for(var r=[],i=[],n=Uint8Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=o.length;a<u;++a)r[a]=o[a],i[o.charCodeAt(a)]=a;function h(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");-1===s&&(s=t);var r=s===t?0:4-s%4;return[s,r]}function l(e){var t=h(e),s=t[0],r=t[1];return(s+r)*3/4-r}function c(e){var t,s,r=h(e),o=r[0],a=r[1],u=new n((o+a)*3/4-a),l=0,c=a>0?o-4:o;for(s=0;s<c;s+=4)t=i[e.charCodeAt(s)]<<18|i[e.charCodeAt(s+1)]<<12|i[e.charCodeAt(s+2)]<<6|i[e.charCodeAt(s+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===a&&(t=i[e.charCodeAt(s)]<<2|i[e.charCodeAt(s+1)]>>4,u[l++]=255&t),1===a&&(t=i[e.charCodeAt(s)]<<10|i[e.charCodeAt(s+1)]<<4|i[e.charCodeAt(s+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u}function d(e){for(var t,s=e.length,i=s%3,n=[],o=0,a=s-i;o<a;o+=16383)n.push(function(e,t,s){for(var i,n=[],o=t;o<s;o+=3)n.push(r[(i=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return n.join("")}(e,o,o+16383>a?a:o+16383));return 1===i?n.push(r[(t=e[s-1])>>2]+r[t<<4&63]+"=="):2===i&&n.push(r[(t=(e[s-2]<<8)+e[s-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),n.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},87:(e,t,s)=>{s.d(t,{i:()=>l});var r,i,n=s(1649),o=Object.defineProperty,a=(e,t,s)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,u=(e,t,s)=>a(e,"symbol"!=typeof t?t+"":t,s);let h=Symbol.for("ConvexError");class l extends(i=Error,r=h,i){constructor(e){super("string"==typeof e?e:(0,n.E$)(e)),u(this,"name","ConvexError"),u(this,"data"),u(this,r,!0),this.data=e}}},4752:(e,t,s)=>{s.d(t,{du:()=>r.du,ik:()=>n.i,o4:()=>i,rz:()=>r.rz});var r=s(1649);s(3671);var i=s(2271),n=s(87)},3671:(e,t,s)=>{s.d(t,{d:()=>k,v:()=>S});var r=s(1649),i=Object.defineProperty,n=(e,t,s)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,o=(e,t,s)=>n(e,"symbol"!=typeof t?t+"":t,s);class a{constructor({isOptional:e}){o(this,"type"),o(this,"fieldPaths"),o(this,"isOptional"),o(this,"isConvexValidator"),this.isOptional=e,this.isConvexValidator=!0}get optional(){return"optional"===this.isOptional}}class u extends a{constructor({isOptional:e,tableName:t}){super({isOptional:e}),o(this,"tableName"),o(this,"kind","id"),this.tableName=t}get json(){return{type:"id",tableName:this.tableName}}asOptional(){return new u({isOptional:"optional",tableName:this.tableName})}}class h extends a{constructor(){super(...arguments),o(this,"kind","float64")}get json(){return{type:"number"}}asOptional(){return new h({isOptional:"optional"})}}class l extends a{constructor(){super(...arguments),o(this,"kind","int64")}get json(){return{type:"bigint"}}asOptional(){return new l({isOptional:"optional"})}}class c extends a{constructor(){super(...arguments),o(this,"kind","boolean")}get json(){return{type:this.kind}}asOptional(){return new c({isOptional:"optional"})}}class d extends a{constructor(){super(...arguments),o(this,"kind","bytes")}get json(){return{type:this.kind}}asOptional(){return new d({isOptional:"optional"})}}class f extends a{constructor(){super(...arguments),o(this,"kind","string")}get json(){return{type:this.kind}}asOptional(){return new f({isOptional:"optional"})}}class g extends a{constructor(){super(...arguments),o(this,"kind","null")}get json(){return{type:this.kind}}asOptional(){return new g({isOptional:"optional"})}}class p extends a{constructor(){super(...arguments),o(this,"kind","any")}get json(){return{type:this.kind}}asOptional(){return new p({isOptional:"optional"})}}class y extends a{constructor({isOptional:e,fields:t}){super({isOptional:e}),o(this,"fields"),o(this,"kind","object"),this.fields=t}get json(){return{type:this.kind,value:globalThis.Object.fromEntries(globalThis.Object.entries(this.fields).map(([e,t])=>[e,{fieldType:t.json,optional:"optional"===t.isOptional}]))}}asOptional(){return new y({isOptional:"optional",fields:this.fields})}}class m extends a{constructor({isOptional:e,value:t}){super({isOptional:e}),o(this,"value"),o(this,"kind","literal"),this.value=t}get json(){return{type:this.kind,value:(0,r.rz)(this.value)}}asOptional(){return new m({isOptional:"optional",value:this.value})}}class w extends a{constructor({isOptional:e,element:t}){super({isOptional:e}),o(this,"element"),o(this,"kind","array"),this.element=t}get json(){return{type:this.kind,value:this.element.json}}asOptional(){return new w({isOptional:"optional",element:this.element})}}class v extends a{constructor({isOptional:e,key:t,value:s}){if(super({isOptional:e}),o(this,"key"),o(this,"value"),o(this,"kind","record"),"optional"===t.isOptional)throw Error("Record validator cannot have optional keys");if("optional"===s.isOptional)throw Error("Record validator cannot have optional values");this.key=t,this.value=s}get json(){return{type:this.kind,keys:this.key.json,values:{fieldType:this.value.json,optional:!1}}}asOptional(){return new v({isOptional:"optional",key:this.key,value:this.value})}}class b extends a{constructor({isOptional:e,members:t}){super({isOptional:e}),o(this,"members"),o(this,"kind","union"),this.members=t}get json(){return{type:this.kind,value:this.members.map(e=>e.json)}}asOptional(){return new b({isOptional:"optional",members:this.members})}}function k(e){return!!e.isConvexValidator}let S={id:e=>new u({isOptional:"required",tableName:e}),null:()=>new g({isOptional:"required"}),number:()=>new h({isOptional:"required"}),float64:()=>new h({isOptional:"required"}),bigint:()=>new l({isOptional:"required"}),int64:()=>new l({isOptional:"required"}),boolean:()=>new c({isOptional:"required"}),string:()=>new f({isOptional:"required"}),bytes:()=>new d({isOptional:"required"}),literal:e=>new m({isOptional:"required",value:e}),array:e=>new w({isOptional:"required",element:e}),object:e=>new y({isOptional:"required",fields:e}),record:(e,t)=>new v({isOptional:"required",key:e,value:t}),union:(...e)=>new b({isOptional:"required",members:e}),any:()=>new p({isOptional:"required"}),optional:e=>e.asOptional()}},1649:(e,t,s)=>{s.d(t,{E$:()=>g,cy:()=>v,du:()=>function e(t){if(null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t)return t;if(Array.isArray(t))return t.map(t=>e(t));if("object"!=typeof t)throw Error(`Unexpected type of ${t}`);let s=Object.entries(t);if(1===s.length){let e=s[0][0];if("$bytes"===e){if("string"!=typeof t.$bytes)throw Error(`Malformed $bytes field on ${t}`);return r.toByteArray(t.$bytes).buffer}if("$integer"===e){if("string"!=typeof t.$integer)throw Error(`Malformed $integer field on ${t}`);return d(t.$integer)}if("$float"===e){if("string"!=typeof t.$float)throw Error(`Malformed $float field on ${t}`);let e=r.toByteArray(t.$float);if(8!==e.byteLength)throw Error(`Received ${e.byteLength} bytes, expected 8 for $float`);let s=new DataView(e.buffer).getFloat64(0,!0);if(!l(s))throw Error(`Float ${s} should be encoded as a number`);return s}if("$set"===e)throw Error("Received a Set which is no longer supported as a Convex type.");if("$map"===e)throw Error("Received a Map which is no longer supported as a Convex type.")}let i={};for(let[s,r]of Object.entries(t))f(s),i[s]=e(r);return i},rz:()=>w});var r=s(2271),i=s(9839);let n=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),a=BigInt("0"),u=BigInt("8"),h=BigInt("256");function l(e){return Number.isNaN(e)||!Number.isFinite(e)||Object.is(e,-0)}let c=DataView.prototype.setBigInt64?function(e){if(e<n||o<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);let t=new ArrayBuffer(8);return new DataView(t).setBigInt64(0,e,!0),r.fromByteArray(new Uint8Array(t))}:function(e){e<a&&(e-=n+n);let t=e.toString(16);t.length%2==1&&(t="0"+t);let s=new Uint8Array(new ArrayBuffer(8)),i=0;for(let r of t.match(/.{2}/g).reverse())s.set([parseInt(r,16)],i++),e>>=u;return r.fromByteArray(s)},d=DataView.prototype.getBigInt64?function(e){let t=r.toByteArray(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);return new DataView(t.buffer).getBigInt64(0,!0)}:function(e){let t=r.toByteArray(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);let s=a,i=a;for(let e of t)s+=BigInt(e)*h**i,i++;return s>o&&(s+=n+n),s};function f(e){if(e.length>1024)throw Error(`Field name ${e} exceeds maximum field name length 1024.`);if(e.startsWith("$"))throw Error(`Field name ${e} starts with a '$', which is reserved.`);for(let t=0;t<e.length;t+=1){let s=e.charCodeAt(t);if(s<32||s>=127)throw Error(`Field name ${e} has invalid character '${e[t]}': Field names can only contain non-control ASCII characters`)}}function g(e){return JSON.stringify(e,(e,t)=>void 0===t?"undefined":"bigint"==typeof t?`${t.toString()}n`:t)}function p(e,t,s,a){if(void 0===e){let e=s&&` (present at path ${s} in original object ${g(t)})`;throw Error(`undefined is not a valid Convex value${e}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(null===e)return e;if("bigint"==typeof e){if(e<n||o<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);return{$integer:c(e)}}if("number"==typeof e){if(!l(e))return e;{let t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e,!0),{$float:r.fromByteArray(new Uint8Array(t))}}}if("boolean"==typeof e||"string"==typeof e)return e;if(e instanceof ArrayBuffer)return{$bytes:r.fromByteArray(new Uint8Array(e))};if(Array.isArray(e))return e.map((e,r)=>p(e,t,s+`[${r}]`,!1));if(e instanceof Set)throw Error(y(s,"Set",[...e],t));if(e instanceof Map)throw Error(y(s,"Map",[...e],t));if(!(0,i.iY)(e)){let r=e?.constructor?.name;throw Error(y(s,r?`${r} `:"",e,t))}let u={},h=Object.entries(e);for(let[e,r]of(h.sort(([e,t],[s,r])=>e===s?0:e<s?-1:1),h))void 0!==r?(f(e),u[e]=p(r,t,s+`.${e}`,!1)):a&&(f(e),u[e]=m(r,t,s+`.${e}`));return u}function y(e,t,s,r){return e?`${t}${g(s)} is not a supported Convex type (present at path ${e} in original object ${g(r)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${t}${g(s)} is not a supported Convex type.`}function m(e,t,s){if(void 0===e)return{$undefined:null};if(void 0===t)throw Error(`Programming error. Current value is ${g(e)} but original value is undefined`);return p(e,t,s,!1)}function w(e){return p(e,e,"",!1)}function v(e){return m(e,e,"")}}}]);